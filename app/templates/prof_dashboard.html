{% extends 'base.html' %}
{% block content %}
<div class="max-w-4xl mx-auto p-6">
    <h2 class="text-2xl font-bold text-blue-600 mb-4">Dashboard Professeur</h2>
    <div id="profStats" class="mb-6 flex gap-6">
        <div class="bg-white rounded shadow p-4 flex-1 text-center">
            <div class="text-lg font-semibold">Cours</div>
            <div id="nbCourses" class="text-3xl text-orange-500 font-bold">0</div>
        </div>
        <div class="bg-white rounded shadow p-4 flex-1 text-center">
            <div class="text-lg font-semibold">Documents</div>
            <div id="nbDocuments" class="text-3xl text-orange-500 font-bold">0</div>
        </div>
    </div>
    <h3 class="text-xl font-semibold mb-2">Séances du jour</h3>
    <div id="todaySessions" class="space-y-4">
        <!-- Séances du jour affichées ici -->
    </div>
</div>
<script>
async function loadDashboard() {
    const res = await fetch('/api/prof/dashboard');
    const data = await res.json();
    document.getElementById('nbCourses').textContent = data.stats.nb_courses;
    document.getElementById('nbDocuments').textContent = data.stats.nb_documents;
    // Séances du jour
    const todaySessions = data.reminders.filter(s => {
        const d = new Date(s.date);
        const now = new Date();
        return d.toDateString() === now.toDateString();
    });
    const container = document.getElementById('todaySessions');
    container.innerHTML = '';
    if (todaySessions.length === 0) {
        container.innerHTML = '<div class="text-gray-500">Aucune séance prévue aujourd\'hui.</div>';
    } else {
        todaySessions.forEach(s => {
            container.innerHTML += `
            <div class="bg-white rounded shadow p-4 flex flex-col md:flex-row md:items-center gap-4">
                <div class="flex-1">
                    <div class="font-semibold text-blue-600">${s.course}</div>
                    <div class="text-gray-700">${new Date(s.date).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}</div>
                    <div class="text-sm text-gray-500">Statut : <span class="font-bold" id="status-${s.course}-${s.date}">${s.status}</span></div>
                </div>
                <div>
                    <select class="px-2 py-1 border rounded" onchange="changeStatus('${s.course}', '${s.date}', this.value)">
                        <option value="en attente" ${s.status==='en attente'?'selected':''}>En attente</option>
                        <option value="effectuée" ${s.status==='effectuée'?'selected':''}>Effectuée</option>
                        <option value="annulée" ${s.status==='annulée'?'selected':''}>Annulée</option>
                    </select>
                </div>
            </div>`;
        });
    }
}
async function changeStatus(course, date, status) {
    // Appel backend pour changer le statut de la séance
    const res = await fetch('api/prof/change-session-status', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({course, date, status})
    });
    if (res.ok) {
        document.getElementById(`status-${course}-${date}`).textContent = status;
    }
}
window.addEventListener('DOMContentLoaded', loadDashboard);
</script>
{% endblock %}
