{% extends 'base.html' %}
{% block content %}
<div class="max-w-3xl mx-auto p-6">
    <h2 class="text-2xl font-bold text-blue-600 mb-4">Ajouter un livre</h2>
    <form id="addBookForm" class="flex flex-col gap-3 mb-6 bg-white rounded shadow p-4" enctype="multipart/form-data">
        <input type="text" name="title" id="bookTitle" class="border rounded px-3 py-2" placeholder="Titre du livre" required>
        <input type="text" name="author" id="bookAuthor" class="border rounded px-3 py-2" placeholder="Auteur" required>
        <input type="file" name="file" id="bookFile" class="border rounded px-3 py-2" accept="application/pdf" required>
        <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded">Ajouter</button>
    </form>
    <h3 class="text-xl font-semibold mb-4">Livres ajoutés</h3>
    <div id="booksList" class="space-y-4"></div>
</div>
<script>
async function loadBooks() {
    const res = await fetch('/api/books');
    const books = await res.json();
    const container = document.getElementById('booksList');
    container.innerHTML = '';
    if (!books.length) {
        container.innerHTML = '<div class="text-gray-500">Aucun livre ajouté pour votre faculté.</div>';
        return;
    }
    books.forEach(book => {
        container.innerHTML += `
        <div class="bg-white rounded shadow p-4 flex flex-col md:flex-row md:items-center gap-4">
            <div class="flex-1">
                <div class="font-semibold text-blue-600">${book.title}</div>
                <div class="text-gray-700 text-sm">${book.author}</div>
                <a href="${book.file_url}" target="_blank" class="text-orange-500 underline">Télécharger</a>
            </div>
            <button onclick="deleteBook('${book.id}')" class="bg-red-500 text-white px-4 py-2 rounded hover:bg-red-700 transition">Supprimer</button>
        </div>`;
    });
}

document.getElementById('addBookForm').addEventListener('submit', async function(e) {
    e.preventDefault();
    const formData = new FormData();
    formData.append('title', document.getElementById('bookTitle').value);
    formData.append('author', document.getElementById('bookAuthor').value);
    formData.append('file', document.getElementById('bookFile').files[0]);
    const res = await fetch('/api/books', {
        method: 'POST',
        body: formData
    });
    if (res.ok) {
        document.getElementById('bookTitle').value = '';
        document.getElementById('bookAuthor').value = '';
        document.getElementById('bookFile').value = '';
        loadBooks();
    }
});

async function deleteBook(bookId) {
    if (!confirm('Supprimer ce livre ?')) return;
    const res = await fetch(`/api/books/${bookId}`, {
        method: 'DELETE'
    });
    if (res.ok) loadBooks();
}

window.addEventListener('DOMContentLoaded', loadBooks);
</script>
{% endblock %}
