<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UniMate</title>
    <!-- Style custom supprimé, tout est Tailwind -->
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="icon" href="/static/logo.png">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<style>
@media (max-width: 767px) {
  #nav-menu.animate-dropdown {
    animation: dropdown-fade 0.25s cubic-bezier(0.4,0,0.2,1);
  }
}
@keyframes dropdown-fade {
  0% { opacity: 0; transform: translateY(-10px) scale(0.98); }
  100% { opacity: 1; transform: translateY(0) scale(1); }
}
</style>
</head>
<body class="bg-white min-h-screen flex flex-col">

    <header class="sticky top-4 left-1/2 transform -translate-x-1/2 w-[98vw] md:w-[90vw] max-w-5xl z-50 rounded-2xl bg-white/40 shadow-xl border border-white/30 navbar-blur">
      <div class="flex items-center justify-between px-4 py-2 md:px-8 md:py-3 relative w-full">
        <div class="flex items-center gap-2 md:gap-4">
          <div class="rounded-full bg-blue-100 p-2 flex items-center justify-center shadow-sm">
            <i class="fa-solid fa-graduation-cap text-blue-600 text-2xl md:text-3xl"></i>
          </div>
          <span class="text-xl md:text-2xl font-bold text-blue-700 tracking-tight drop-shadow-sm">UniMate</span>
        </div>
        <!-- Unified nav menu, responsive for desktop and mobile -->
        <nav id="nav-menu" class="hidden md:flex flex-row gap-4 items-center px-4 transition-all duration-300 md:static md:top-auto md:left-auto md:rounded-2xl">
          {% if session.get('user_id') and session.get('role') == 'student' %}
            <a href="/student/dashboard" class="text-blue-600 hover:text-orange-500 font-semibold text-2xl md:text-base flex items-center gap-4 transition px-8 py-4 md:px-4 md:py-2 rounded-2xl md:rounded-lg w-[90vw] md:w-auto justify-center md:justify-start text-center"><i class="fa fa-home"></i>Dashboard</a>
            <a href="/student/courses" class="text-blue-600 hover:text-orange-500 font-semibold text-2xl md:text-base flex items-center gap-4 transition px-8 py-4 md:px-4 md:py-2 rounded-2xl md:rounded-lg w-[90vw] md:w-auto justify-center md:justify-start text-center"><i class="fa fa-book"></i>Mes cours</a>
            <a href="/student/books" class="text-blue-600 hover:text-orange-500 font-semibold text-2xl md:text-base flex items-center gap-4 transition px-8 py-4 md:px-4 md:py-2 rounded-2xl md:rounded-lg w-[90vw] md:w-auto justify-center md:justify-start text-center"><i class="fa fa-book-open"></i>Livres</a>
            <a href="/student/profile" class="text-blue-600 hover:text-orange-500 font-semibold text-2xl md:text-base flex items-center gap-4 transition px-8 py-4 md:px-4 md:py-2 rounded-2xl md:rounded-lg w-[90vw] md:w-auto justify-center md:justify-start text-center"><i class="fa fa-user"></i>Profil</a>
            <!-- <a href="/student/chatbot" class="text-blue-600 hover:text-orange-500 font-semibold text-2xl md:text-base flex items-center gap-4 transition px-8 py-4 md:px-4 md:py-2 rounded-2xl md:rounded-lg w-[90vw] md:w-auto justify-center md:justify-start text-center"><i class="fa fa-robot"></i>Chatbot</a> -->
            <a href="/logout" class="text-orange-500 hover:text-blue-600 font-semibold text-2xl md:text-base flex items-center gap-4 transition px-8 py-4 md:px-4 md:py-2 rounded-2xl md:rounded-lg w-[90vw] md:w-auto justify-center md:justify-start text-center" style="color: #ff9800;"><i class="fa fa-sign-out-alt"></i>Déconnexion</a>
          {% elif session.get('user_id') and session.get('role') == 'prof' %}
            <a href="/prof/dashboard" class="text-blue-600 hover:text-orange-500 font-semibold text-2xl md:text-base flex items-center gap-4 transition px-8 py-4 md:px-4 md:py-2 rounded-2xl md:rounded-lg w-[90vw] md:w-auto justify-center md:justify-start text-center"><i class="fa fa-home"></i>Dashboard</a>
            <a href="/prof/courses" class="text-blue-600 hover:text-orange-500 font-semibold text-2xl md:text-base flex items-center gap-4 transition px-8 py-4 md:px-4 md:py-2 rounded-2xl md:rounded-lg w-[90vw] md:w-auto justify-center md:justify-start text-center"><i class="fa fa-book"></i>Mes cours</a>
            <a href="/prof/documents" class="text-blue-600 hover:text-orange-500 font-semibold text-2xl md:text-base flex items-center gap-4 transition px-8 py-4 md:px-4 md:py-2 rounded-2xl md:rounded-lg w-[90vw] md:w-auto justify-center md:justify-start text-center"><i class="fa fa-file-alt"></i>Documents</a>
            <a href="/prof/profile" class="text-blue-600 hover:text-orange-500 font-semibold text-2xl md:text-base flex items-center gap-4 transition px-8 py-4 md:px-4 md:py-2 rounded-2xl md:rounded-lg w-[90vw] md:w-auto justify-center md:justify-start text-center"><i class="fa fa-user"></i>Profil</a>
            <a href="/logout" class="text-orange-500 hover:text-blue-600 font-semibold text-2xl md:text-base flex items-center gap-4 transition px-8 py-4 md:px-4 md:py-2 rounded-2xl md:rounded-lg w-[90vw] md:w-auto justify-center md:justify-start text-center" style="color: #ff9800;"><i class="fa fa-sign-out-alt"></i>Déconnexion</a>
          {% elif session.get('user_id') and session.get('role') == 'faculty_admin' %}
            <a href="/faculty/dashboard" class="text-blue-600 hover:text-orange-500 font-semibold text-2xl md:text-base flex items-center gap-4 transition px-8 py-4 md:px-4 md:py-2 rounded-2xl md:rounded-lg w-[90vw] md:w-auto justify-center md:justify-start text-center"><i class="fa fa-home"></i>Dashboard</a>
            <a href="/faculty/courses" class="text-blue-600 hover:text-orange-500 font-semibold text-2xl md:text-base flex items-center gap-4 transition px-8 py-4 md:px-4 md:py-2 rounded-2xl md:rounded-lg w-[90vw] md:w-auto justify-center md:justify-start text-center"><i class="fa fa-book"></i>Cours</a>
            <a href="/faculty/books" class="text-blue-600 hover:text-orange-500 font-semibold text-2xl md:text-base flex items-center gap-4 transition px-8 py-4 md:px-4 md:py-2 rounded-2xl md:rounded-lg w-[90vw] md:w-auto justify-center md:justify-start text-center"><i class="fa fa-book-open"></i>Livres</a>
            <a href="/faculty/users" class="text-blue-600 hover:text-orange-500 font-semibold text-2xl md:text-base flex items-center gap-4 transition px-8 py-4 md:px-4 md:py-2 rounded-2xl md:rounded-lg w-[90vw] md:w-auto justify-center md:justify-start text-center"><i class="fa fa-users"></i>Utilisateurs</a>
            <a href="/faculty/department" class="text-blue-600 hover:text-orange-500 font-semibold text-2xl md:text-base flex items-center gap-4 transition px-8 py-4 md:px-4 md:py-2 rounded-2xl md:rounded-lg w-[90vw] md:w-auto justify-center md:justify-start text-center"><i class="fa fa-building"></i>Départements</a>
            <a href="/faculty/promotion" class="text-blue-600 hover:text-orange-500 font-semibold text-2xl md:text-base flex items-center gap-4 transition px-8 py-4 md:px-4 md:py-2 rounded-2xl md:rounded-lg w-[90vw] md:w-auto justify-center md:justify-start text-center"><i class="fa fa-graduation-cap"></i>Promotions</a>
            <a href="/faculty/profile" class="text-blue-600 hover:text-orange-500 font-semibold text-2xl md:text-base flex items-center gap-4 transition px-8 py-4 md:px-4 md:py-2 rounded-2xl md:rounded-lg w-[90vw] md:w-auto justify-center md:justify-start text-center"><i class="fa fa-user"></i>Profil</a>
            <a href="/logout" class="text-orange-500 hover:text-blue-600 font-semibold text-2xl md:text-base flex items-center gap-4 transition px-8 py-4 md:px-4 md:py-2 rounded-2xl md:rounded-lg w-[90vw] md:w-auto justify-center md:justify-start text-center" style="color: #ff9800;"><i class="fa fa-sign-out-alt"></i>Déconnexion</a>
          {% elif session.get('user_id') and session.get('role') == 'superadmin' %}
            <a href="/admin/dashboard" class="text-blue-600 hover:text-orange-500 font-semibold text-2xl md:text-base flex items-center gap-4 transition px-8 py-4 md:px-4 md:py-2 rounded-2xl md:rounded-lg w-[90vw] md:w-auto justify-center md:justify-start text-center"><i class="fa fa-home"></i>Dashboard</a>
            <a href="/admin/users" class="text-blue-600 hover:text-orange-500 font-semibold text-2xl md:text-base flex items-center gap-4 transition px-8 py-4 md:px-4 md:py-2 rounded-2xl md:rounded-lg w-[90vw] md:w-auto justify-center md:justify-start text-center"><i class="fa fa-users"></i>Utilisateurs</a>
            <a href="/admin/academicyears" class="text-blue-600 hover:text-orange-500 font-semibold text-2xl md:text-base flex items-center gap-4 transition px-8 py-4 md:px-4 md:py-2 rounded-2xl md:rounded-lg w-[90vw] md:w-auto justify-center md:justify-start text-center"><i class="fa fa-calendar-alt"></i>Années académiques</a>
            <a href="/admin/faculties" class="text-blue-600 hover:text-orange-500 font-semibold text-2xl md:text-base flex items-center gap-4 transition px-8 py-4 md:px-4 md:py-2 rounded-2xl md:rounded-lg w-[90vw] md:w-auto justify-center md:justify-start text-center"><i class="fa fa-university"></i>Facultés</a>
            <a href="/admin/promotions" class="text-blue-600 hover:text-orange-500 font-semibold text-2xl md:text-base flex items-center gap-4 transition px-8 py-4 md:px-4 md:py-2 rounded-2xl md:rounded-lg w-[90vw] md:w-auto justify-center md:justify-start text-center"><i class="fa fa-graduation-cap"></i>Promotions</a>
            <a href="/admin/departments" class="text-blue-600 hover:text-orange-500 font-semibold text-2xl md:text-base flex items-center gap-4 transition px-8 py-4 md:px-4 md:py-2 rounded-2xl md:rounded-lg w-[90vw] md:w-auto justify-center md:justify-start text-center"><i class="fa fa-building"></i>Départements</a>
            <a href="/admin/courses" class="text-blue-600 hover:text-orange-500 font-semibold text-2xl md:text-base flex items-center gap-4 transition px-8 py-4 md:px-4 md:py-2 rounded-2xl md:rounded-lg w-[90vw] md:w-auto justify-center md:justify-start text-center"><i class="fa fa-book"></i>Cours</a>
            <a href="/admin/books" class="text-blue-600 hover:text-orange-500 font-semibold text-2xl md:text-base flex items-center gap-4 transition px-8 py-4 md:px-4 md:py-2 rounded-2xl md:rounded-lg w-[90vw] md:w-auto justify-center md:justify-start text-center"><i class="fa fa-book-open"></i>Livres</a>
            <a href="/logout" class="text-orange-500 hover:text-blue-600 font-semibold text-2xl md:text-base flex items-center gap-4 transition px-8 py-4 md:px-4 md:py-2 rounded-2xl md:rounded-lg w-[90vw] md:w-auto justify-center md:justify-start text-center" style="color: #ff9800;"><i class="fa fa-sign-out-alt"></i>Déconnexion</a>
          {% else %}
            <a href="/" class="text-blue-600 hover:text-orange-500 font-semibold text-2xl md:text-base flex items-center gap-4 transition px-8 py-4 md:px-4 md:py-2 rounded-2xl md:rounded-lg w-[90vw] md:w-auto justify-center md:justify-start text-center"><i class="fa fa-home"></i>Accueil</a>
            <a href="/about" class="text-blue-600 hover:text-orange-500 font-semibold text-2xl md:text-base flex items-center gap-4 transition px-8 py-4 md:px-4 md:py-2 rounded-2xl md:rounded-lg w-[90vw] md:w-auto justify-center md:justify-start text-center"><i class="fa fa-info-circle"></i>À propos</a>
            <a href="/login" class="text-blue-600 hover:text-orange-500 font-semibold text-2xl md:text-base flex items-center gap-4 transition px-8 py-4 md:px-4 md:py-2 rounded-2xl md:rounded-lg w-[90vw] md:w-auto justify-center md:justify-start text-center"><i class="fa fa-sign-in-alt"></i>Connexion</a>
            <a href="/register" class="text-blue-600 hover:text-orange-500 font-semibold text-2xl md:text-base flex items-center gap-4 transition px-8 py-4 md:px-4 md:py-2 rounded-2xl md:rounded-lg w-[90vw] md:w-auto justify-center md:justify-start text-center" ><i class="fa fa-user-plus"></i>Inscription</a>
          {% endif %}
        </nav>
        <!-- Menu mobile hamburger -->
        <button id="menu-btn" class="md:hidden text-blue-600 focus:outline-none transition-all duration-300 ml-4" aria-label="Ouvrir le menu">
          <i id="menu-icon" class="fa fa-bars text-2xl"></i>
        </button>
      </div>
      <div id="nav-overlay" class="fixed inset-0 bg-black/40 backdrop-blur-sm z-30 hidden md:hidden transition-all duration-300"></div>
<!-- Removed .nav-link @apply block; use Tailwind classes directly on elements instead -->
    </header>
    <!-- Overlay supprimé, on applique le blur/dark directement sur main et footer via .menu-open sur <body> -->
    <script>
        const menuBtn = document.getElementById('menu-btn');
        const navMenu = document.getElementById('nav-menu');
        const menuIcon = document.getElementById('menu-icon');
        const navOverlay = document.getElementById('nav-overlay');
        let menuOpen = false;
        const mainBlurOverlay = document.getElementById('main-blur-overlay');

        function openMenu() {
            navMenu.classList.remove('hidden', 'md:flex-row', 'md:static', 'md:bg-transparent', 'md:shadow-none', 'md:w-auto', 'md:h-auto', 'md:pt-0', 'md:z-auto', 'md:opacity-100', 'md:transform-none', 'md:items-center', 'md:gap-4', 'px-4');
            navMenu.classList.add('flex', 'flex-col', 'absolute', 'left-[42%]', 'right-auto', 'top-full', 'z-50', 'w-[92vw]', 'max-w-xs', '-translate-x-1/2', 'bg-white/90', 'backdrop-blur-lg', 'rounded-2xl', 'shadow-2xl', 'border', 'border-white/40', 'gap-4', 'py-4', 'mt-2', 'animate-dropdown');
            navOverlay.classList.remove('hidden');
            navOverlay.classList.add('opacity-100');
            menuIcon.classList.remove('fa-bars');
            menuIcon.classList.add('fa-times');
            document.body.style.overflow = 'hidden';
            document.body.classList.add('menu-open');
            menuOpen = true;
        }
        function closeMenu() {
            navMenu.classList.add('hidden');
            navMenu.classList.remove('flex', 'flex-col', 'absolute', 'left-[42%]', 'right-auto', 'top-full', 'z-50', 'w-[92vw]', 'max-w-xs', '-translate-x-1/2', 'bg-white/90', 'backdrop-blur-lg', 'rounded-2xl', 'shadow-2xl', 'border', 'border-white/40', 'gap-4', 'py-4', 'mt-2', 'animate-dropdown');
            navMenu.classList.add('md:flex', 'md:flex-row', 'md:static', 'md:bg-transparent', 'md:shadow-none', 'md:w-auto', 'md:h-auto', 'md:pt-0', 'md:z-auto', 'md:opacity-100', 'md:transform-none', 'md:items-center', 'md:gap-4', 'px-4');
            navOverlay.classList.add('hidden');
            navOverlay.classList.remove('opacity-100');
            menuIcon.classList.remove('fa-times');
            menuIcon.classList.add('fa-bars');
            document.body.style.overflow = '';
            document.body.classList.remove('menu-open');
            menuOpen = false;
        }
        menuBtn.addEventListener('click', () => {
            if (!menuOpen) {
                openMenu();
            } else {
                closeMenu();
            }
        });
        navOverlay.addEventListener('click', closeMenu);
        window.addEventListener('resize', () => {
            if (window.innerWidth >= 768) {
                closeMenu();
            }
        });
        // Optional: close menu on navigation click (mobile only)
        navMenu.querySelectorAll('a').forEach(link => {
          link.addEventListener('click', () => {
            if (window.innerWidth < 768) closeMenu();
          });
        });
    </script>
<main id="main-content" class="flex-1 flex flex-col items-center justify-center w-full transition-all duration-300">
    {% block content %}{% endblock %}
</main>
    <footer id="main-footer" class="bg-white text-center py-4 shadow-inner mt-auto transition-all duration-300">
        <span class="text-gray-500">© 2025 UniMate. Tous droits réservés.</span>
    </footer>
<style>
  body.menu-open #main-content,
  body.menu-open #main-footer {
    filter: blur(6px) brightness(0.5);
    pointer-events: none;
    user-select: none;
    transition: filter 0.3s;
  }
  body.menu-open #main-content {
    /* Pour éviter le scroll sur le contenu flouté */
    overflow: hidden;
  }
</style>
<style>
  /* Flou dynamique sous la navbar */
  .navbar-blur {
    position: relative;
    z-index: 50;
    /* L'effet glassmorphism est géré par les classes et le style inline */
  }
  .navbar-blur::after {
    display: none;
  }
</style>
</body>
<script>
// Détection expiration de session : sur chaque requête AJAX, si 401, redirige vers /logout
function handleSessionExpiration(response) {
  if (response.status === 401) {
    window.location.href = '/logout';
    return true;
  }
  return false;
}
// Patch fetch global
const origFetch = window.fetch;
window.fetch = function() {
  return origFetch.apply(this, arguments).then(res => {
    if (handleSessionExpiration(res)) return new Promise(() => {});
    return res;
  });
};
</script>
</html>
