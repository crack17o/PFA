<div id="course-modal" class="fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50 hidden">
  <div class="bg-white rounded-lg shadow-lg p-8 w-full max-w-md">
    <h2 class="text-xl font-bold mb-4">S'inscrire à un cours</h2>
    <select id="available-courses" class="w-full border rounded px-3 py-2 mb-4"></select>
    <div class="flex justify-end gap-2">
      <button id="close-modal" class="bg-gray-400 text-white px-4 py-2 rounded">Annuler</button>
      <button id="enroll-btn" class="bg-blue-600 text-white px-4 py-2 rounded">S'inscrire</button>
    </div>
    <div id="modal-msg" class="mt-4 text-center text-sm"></div>
  </div>
</div>
<script>
function showCourseModal() {
  document.getElementById('course-modal').classList.remove('hidden');
  fetch('/api/student/courses', {method: 'GET'})
    .then(res => res.json())
    .then(data => {
      const select = document.getElementById('available-courses');
      select.innerHTML = '';
      (data || []).forEach(c => {
        const option = document.createElement('option');
        option.value = c.id;
        option.textContent = `${c.name} (${c.credits} crédits)`;
        select.appendChild(option);
      });
    });
}
document.getElementById('add-course-btn').onclick = showCourseModal;
document.getElementById('close-modal').onclick = function() {
  document.getElementById('course-modal').classList.add('hidden');
};
document.getElementById('enroll-btn').onclick = function() {
  const courseId = document.getElementById('available-courses').value;
  fetch('/api/student/courses', {
    method: 'POST',
    headers: {'Content-Type': 'application/json'},
    body: JSON.stringify({course_id: courseId})
  }).then(res => res.json()).then(data => {
    document.getElementById('modal-msg').textContent = data.message || 'Inscription effectuée.';
    setTimeout(() => {
      document.getElementById('course-modal').classList.add('hidden');
      window.location.reload();
    }, 1000);
  });
};
</script>
